# ğŸ¬ DanPlay - ç°ä»£åŒ–å¼¹å¹•è§†é¢‘æ’­æ”¾å™¨

<div align="center">

![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)
![FastAPI](https://img.shields.io/badge/FastAPI-0.100+-green.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)
![Platform](https://img.shields.io/badge/Platform-Windows%20%7C%20Linux%20%7C%20macOS-lightgrey.svg)

ä¸€ä¸ªåŸºäº FastAPI æ„å»ºçš„ç°ä»£åŒ–æœ¬åœ°è§†é¢‘å¼¹å¹•æ’­æ”¾å™¨ï¼Œè®©æ‚¨åœ¨è§‚çœ‹æœ¬åœ°è§†é¢‘æ—¶ä¹Ÿèƒ½äº«å—å¼¹å¹•çš„ä¹è¶£ã€‚

[åŠŸèƒ½ç‰¹ç‚¹](#-åŠŸèƒ½ç‰¹ç‚¹) â€¢ [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [æŠ€æœ¯æ¶æ„](#-æŠ€æœ¯æ¶æ„) â€¢ [APIæ–‡æ¡£](#-apiæ–‡æ¡£) â€¢ [è´¡çŒ®æŒ‡å—](#-è´¡çŒ®æŒ‡å—)

</div>

---

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **ğŸ“ æœ¬åœ°è§†é¢‘æ’­æ”¾** - æ”¯æŒæ‹–æ‹½ä¸Šä¼ ï¼Œæ‰¹é‡å¤„ç†ï¼Œæ”¯æŒ MP4/MKV/AVI ç­‰ä¸»æµæ ¼å¼
- **ğŸ” æ™ºèƒ½å¼¹å¹•åŒ¹é…** - åŸºäºè§†é¢‘æŒ‡çº¹è‡ªåŠ¨åŒ¹é…å¼¹å¹•ï¼Œæ— éœ€æ‰‹åŠ¨æœç´¢
- **ğŸ’¬ å¤šæºå¼¹å¹•æ”¯æŒ** - å…¼å®¹ Bç«™ã€Aç«™ç­‰å¤šä¸ªå¼¹å¹•æº
- **ğŸ¨ ç°ä»£åŒ–UIè®¾è®¡** - å“åº”å¼å¸ƒå±€ï¼Œæ”¯æŒæ·±è‰²æ¨¡å¼ï¼Œæµç•…çš„åŠ¨ç”»æ•ˆæœ

### ğŸš€ è¿›é˜¶ç‰¹æ€§
- **âš™ï¸ ä¸°å¯Œçš„è®¾ç½®é€‰é¡¹** - æ’­æ”¾å™¨å†…æ ¸åˆ‡æ¢ã€å¼¹å¹•æ ·å¼è‡ªå®šä¹‰ã€ç½‘ç»œä»£ç†é…ç½®
- **ğŸ“Š å®æ—¶é€šä¿¡** - WebSocket æ”¯æŒï¼Œå®æ—¶çŠ¶æ€åŒæ­¥
- **ğŸ”„ æ ¼å¼è½¬æ¢** - æ”¯æŒå¤šç§å¼¹å¹•æ ¼å¼äº’è½¬ï¼ˆXML/ASS/JSONï¼‰
- **ğŸ’¾ æ™ºèƒ½ç¼“å­˜** - åŒ¹é…ç»“æœç¼“å­˜ï¼Œæå‡äºŒæ¬¡åŠ è½½é€Ÿåº¦
- **ğŸ“± å“åº”å¼è®¾è®¡** - å®Œç¾é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡

## ğŸ–¼ï¸ ç•Œé¢é¢„è§ˆ

<details>
<summary>ç‚¹å‡»æŸ¥çœ‹ç•Œé¢æˆªå›¾</summary>

### ä¸»ç•Œé¢
- ç°ä»£åŒ–è®¾è®¡é£æ ¼
- æ¸å˜èƒŒæ™¯åŠ¨æ•ˆ
- ç›´è§‚çš„æ‹–æ‹½ä¸Šä¼ åŒºåŸŸ

### è®¾ç½®é¡µé¢
- åˆ†ç±»æ¸…æ™°çš„è®¾ç½®é¡¹
- å®æ—¶é¢„è§ˆæ•ˆæœ
- å¯¼å…¥/å¯¼å‡ºé…ç½®

### æ’­æ”¾ç•Œé¢
- å¤šç§æ’­æ”¾å™¨å†…æ ¸å¯é€‰
- å¼¹å¹•å®æ—¶æ¸²æŸ“
- æ’­æ”¾æ§åˆ¶æ 

</details>

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.11 æˆ–æ›´é«˜ç‰ˆæœ¬
- ç°ä»£æµè§ˆå™¨ï¼ˆChrome/Firefox/Edge/Safariï¼‰
- å¯é€‰ï¼šffmpegï¼ˆç”¨äºè§†é¢‘å¤„ç†ï¼‰

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/yourusername/danplay.git
cd danplay
```

2. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**
```bash
# Windows
python -m venv venv
venv\Scripts\activate

# Linux/macOS
python3 -m venv venv
source venv/bin/activate
```

3. **å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```

4. **é…ç½®ç¯å¢ƒå˜é‡**
```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®å¿…è¦çš„å‚æ•°
# ä¸»è¦é…ç½®é¡¹ï¼š
# - SECRET_KEY: åº”ç”¨å¯†é’¥
# - DANDAN_API_BASE_URL: å¼¹å¼¹play APIåœ°å€
# - MAX_UPLOAD_SIZE: æœ€å¤§ä¸Šä¼ æ–‡ä»¶å¤§å°
```

5. **è¿è¡Œåº”ç”¨**
```bash
# å¼€å‘æ¨¡å¼
python -m uvicorn app.main:app --reload --host 127.0.0.1 --port 8000

# ç”Ÿäº§æ¨¡å¼
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --workers 4
```

6. **è®¿é—®åº”ç”¨**

æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8000

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: FastAPI - é«˜æ€§èƒ½å¼‚æ­¥Webæ¡†æ¶
- **å¼‚æ­¥**: asyncio + aiofiles - å¼‚æ­¥I/Oæ“ä½œ
- **HTTPå®¢æˆ·ç«¯**: httpx - ç°ä»£HTTPå®¢æˆ·ç«¯
- **WebSocket**: websockets - å®æ—¶åŒå‘é€šä¿¡
- **éªŒè¯**: Pydantic - æ•°æ®éªŒè¯å’Œè®¾ç½®ç®¡ç†

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ ¸å¿ƒ**: åŸç”Ÿ HTML5 + CSS3 + JavaScript ES6+
- **æ ·å¼**: ç°ä»£CSSï¼ˆGrid/Flexbox/CSSå˜é‡ï¼‰
- **åŠ¨ç”»**: CSSåŠ¨ç”» + JavaScriptåŠ¨æ•ˆ
- **æ’­æ”¾å™¨**: æ”¯æŒå¤šç§æ’­æ”¾å™¨å†…æ ¸ï¼ˆNPlayer/ArtPlayer/DPlayerï¼‰

### é¡¹ç›®ç»“æ„
```
danplay/
â”œâ”€â”€ app/                    # åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ api/               # APIè·¯ç”±ç«¯ç‚¹
â”‚   â”‚   â”œâ”€â”€ video.py      # è§†é¢‘ç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ danmaku.py    # å¼¹å¹•ç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ match.py      # åŒ¹é…ç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ websocket.py  # WebSocketå¤„ç†
â”‚   â”‚   â””â”€â”€ settings.py   # è®¾ç½®ç›¸å…³API
â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ exceptions.py # å¼‚å¸¸å¤„ç†
â”‚   â”‚   â””â”€â”€ websocket.py  # WebSocketç®¡ç†
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ danmaku_service.py  # å¼¹å¹•å¤„ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ dandan_service.py   # å¼¹å¼¹play APIæœåŠ¡
â”‚   â”‚   â””â”€â”€ video_service.py    # è§†é¢‘å¤„ç†æœåŠ¡
â”‚   â”œâ”€â”€ schemas/           # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ config.py         # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ main.py           # åº”ç”¨å…¥å£
â”œâ”€â”€ static/                # é™æ€èµ„æº
â”‚   â”œâ”€â”€ css/              # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ modern.css    # ç°ä»£åŒ–æ ·å¼
â”‚   â””â”€â”€ js/               # JavaScriptæ–‡ä»¶
â”‚       â”œâ”€â”€ app.js        # ä¸»åº”ç”¨é€»è¾‘
â”‚       â”œâ”€â”€ playlist.js   # æ’­æ”¾åˆ—è¡¨ç®¡ç†
â”‚       â””â”€â”€ settings-manager.js # è®¾ç½®ç®¡ç†å™¨
â”œâ”€â”€ templates/             # HTMLæ¨¡æ¿
â”‚   â”œâ”€â”€ index.html        # ä¸»é¡µ
â”‚   â”œâ”€â”€ settings.html     # è®¾ç½®é¡µ
â”‚   â””â”€â”€ splash.html       # å¯åŠ¨é¡µ
â”œâ”€â”€ uploads/              # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”œâ”€â”€ docs/                 # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ tests/                # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ .env.example          # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ requirements.txt      # Pythonä¾èµ–
â”œâ”€â”€ Dockerfile           # Dockeré•œåƒæ„å»º
â””â”€â”€ docker-compose.yml   # Dockerç¼–æ’é…ç½®
```

## ğŸ“¡ APIæ–‡æ¡£

### è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£
å¯åŠ¨åº”ç”¨åï¼Œè®¿é—®ä»¥ä¸‹åœ°å€æŸ¥çœ‹äº¤äº’å¼APIæ–‡æ¡£ï¼š
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### ä¸»è¦APIç«¯ç‚¹

#### è§†é¢‘ç®¡ç†
| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| POST | `/api/video/upload` | ä¸Šä¼ è§†é¢‘æ–‡ä»¶ |
| GET | `/api/video/stream/{video_id}` | æµå¼æ’­æ”¾è§†é¢‘ |
| GET | `/api/video/md5/{video_id}` | è·å–è§†é¢‘MD5æŒ‡çº¹ |
| DELETE | `/api/video/{video_id}` | åˆ é™¤è§†é¢‘ |

#### å¼¹å¹•åŒ¹é…
| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| POST | `/api/match/` | æ ¹æ®MD5åŒ¹é…è§†é¢‘ |
| GET | `/api/match/search` | æœç´¢åŠ¨ç”»ä½œå“ |
| GET | `/api/match/anime/{anime_id}` | è·å–åŠ¨ç”»è¯¦æƒ… |

#### å¼¹å¹•å¤„ç†
| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| GET | `/api/danmaku/{episode_id}` | è·å–å¼¹å¹•æ•°æ® |
| POST | `/api/danmaku/external` | è·å–ç¬¬ä¸‰æ–¹å¼¹å¹• |
| POST | `/api/danmaku/parse/xml` | è§£æXMLå¼¹å¹• |
| POST | `/api/danmaku/convert` | è½¬æ¢å¼¹å¹•æ ¼å¼ |

#### è®¾ç½®ç®¡ç†
| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| GET | `/api/settings` | è·å–ç”¨æˆ·è®¾ç½® |
| POST | `/api/settings` | ä¿å­˜ç”¨æˆ·è®¾ç½® |
| DELETE | `/api/settings` | é‡ç½®ä¸ºé»˜è®¤è®¾ç½® |

## ğŸ³ Dockeréƒ¨ç½²

### ä½¿ç”¨é¢„æ„å»ºé•œåƒ
```bash
docker run -d \
  --name danplay \
  -p 8000:8000 \
  -v ./uploads:/app/uploads \
  -v ./user_settings.json:/app/user_settings.json \
  danplay:latest
```

### è‡ªè¡Œæ„å»ºé•œåƒ
```bash
# æ„å»ºé•œåƒ
docker build -t danplay .

# ä½¿ç”¨docker-compose
docker-compose up -d
```

### Docker Composeé…ç½®
```yaml
version: '3.8'
services:
  danplay:
    build: .
    ports:
      - "8000:8000"
    volumes:
      - ./uploads:/app/uploads
      - ./user_settings.json:/app/user_settings.json
    environment:
      - SECRET_KEY=your-secret-key-here
    restart: unless-stopped
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
| å˜é‡å | é»˜è®¤å€¼ | æè¿° |
|--------|--------|------|
| `SECRET_KEY` | - | åº”ç”¨å¯†é’¥ï¼ˆå¿…å¡«ï¼‰ |
| `DEBUG` | `false` | è°ƒè¯•æ¨¡å¼ |
| `HOST` | `0.0.0.0` | ç›‘å¬åœ°å€ |
| `PORT` | `8000` | ç›‘å¬ç«¯å£ |
| `MAX_UPLOAD_SIZE` | `5368709120` | æœ€å¤§ä¸Šä¼ å¤§å°(å­—èŠ‚) |
| `DANDAN_API_BASE_URL` | `https://api.dandanplay.net/api/v2` | APIåœ°å€ |
| `DANDAN_PROXY_URL` | - | ä»£ç†åœ°å€ï¼ˆå¯é€‰ï¼‰ |

### ç”¨æˆ·è®¾ç½®
ç”¨æˆ·è®¾ç½®ä¿å­˜åœ¨ `user_settings.json` æ–‡ä»¶ä¸­ï¼ŒåŒ…å«ï¼š
- ç•Œé¢ä¸»é¢˜å’Œè¯­è¨€
- æ’­æ”¾å™¨é…ç½®
- å¼¹å¹•æ ·å¼è®¾ç½®
- ç½‘ç»œä»£ç†é…ç½®
- é«˜çº§é€‰é¡¹

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼æ— è®ºæ˜¯æ–°åŠŸèƒ½ã€bugä¿®å¤è¿˜æ˜¯æ–‡æ¡£æ”¹è¿›ã€‚

### å¦‚ä½•è´¡çŒ®

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### å¼€å‘è§„èŒƒ
- éµå¾ª PEP 8 Pythonä»£ç è§„èŒƒ
- æ·»åŠ é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ›´æ–° README æ–‡æ¡£

### æŠ¥å‘Šé—®é¢˜
å¦‚æœæ‚¨å‘ç°äº†bugæˆ–æœ‰åŠŸèƒ½å»ºè®®ï¼Œè¯·[åˆ›å»ºIssue](https://github.com/yourusername/danplay/issues)

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01)
- ğŸ‰ é¦–æ¬¡å‘å¸ƒ
- âœ¨ ç°ä»£åŒ–UIé‡æ„
- ğŸš€ æ€§èƒ½ä¼˜åŒ–
- ğŸ”§ å®Œå–„è®¾ç½®åŠŸèƒ½
- ğŸ› ä¿®å¤å·²çŸ¥é—®é¢˜

æŸ¥çœ‹[å®Œæ•´æ›´æ–°æ—¥å¿—](CHANGELOG.md)

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ™ è‡´è°¢

- [å¼¹å¼¹play](https://www.dandanplay.com/) - ä¼˜ç§€çš„å¼¹å¹•æ’­æ”¾å™¨
- [å¼¹å¼¹playå¼€æ”¾å¹³å°](https://api.dandanplay.net) - æä¾›APIæ”¯æŒ
- [FastAPI](https://fastapi.tiangolo.com) - ç°ä»£Webæ¡†æ¶
- æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·çš„æ”¯æŒ

## ğŸ“® è”ç³»æ–¹å¼

- é¡¹ç›®ä¸»é¡µ: [https://github.com/yourusername/danplay](https://github.com/yourusername/danplay)
- Issueåé¦ˆ: [https://github.com/yourusername/danplay/issues](https://github.com/yourusername/danplay/issues)
- Email: your-email@example.com

---

<div align="center">
  <sub>ç”¨ â¤ï¸ æ‰“é€ ï¼Œè®©æœ¬åœ°è§†é¢‘è§‚çœ‹æ›´æœ‰è¶£</sub>
</div>