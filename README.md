# ğŸ¬ DanPlay - ç°ä»£åŒ–å¼¹å¹•è§†é¢‘æ’­æ”¾å™¨

<div align="center">

![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)
![FastAPI](https://img.shields.io/badge/FastAPI-0.110+-green.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)
![Docker](https://img.shields.io/badge/Docker-Ready-blue.svg)
![Platform](https://img.shields.io/badge/Platform-Windows%20%7C%20Linux%20%7C%20macOS-lightgrey.svg)

**ä¸€ä¸ªåŸºäº FastAPI æ„å»ºçš„ç°ä»£åŒ–æœ¬åœ°è§†é¢‘å¼¹å¹•æ’­æ”¾å™¨**

è®©æ‚¨åœ¨è§‚çœ‹æœ¬åœ°è§†é¢‘æ—¶ä¹Ÿèƒ½äº«å—å¼¹å¹•å¸¦æ¥çš„ä¹è¶£ï¼Œæ”¯æŒè‡ªåŠ¨åŒ¹é…å¼¹å¹•ã€å¤šæ’­æ”¾å™¨å†…æ ¸ã€å®æ—¶è®¾ç½®åŒæ­¥ç­‰åŠŸèƒ½ã€‚

[åœ¨çº¿æ¼”ç¤º](#) â€¢ [åŠŸèƒ½ç‰¹ç‚¹](#-åŠŸèƒ½ç‰¹ç‚¹) â€¢ [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [Dockeréƒ¨ç½²](#-dockeréƒ¨ç½²) â€¢ [å¼€å‘æ–‡æ¡£](#-å¼€å‘æ–‡æ¡£)

<img src="docs/screenshots/main.png" alt="ä¸»ç•Œé¢" width="800">

</div>

---

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | æè¿° |
|------|------|
| **ğŸ“ æœ¬åœ°è§†é¢‘æ’­æ”¾** | æ”¯æŒæ‹–æ‹½ä¸Šä¼ ã€æ‰¹é‡å¤„ç†ï¼Œå…¼å®¹ MP4/MKV/AVI/FLV ç­‰ä¸»æµæ ¼å¼ |
| **ğŸ” æ™ºèƒ½å¼¹å¹•åŒ¹é…** | åŸºäºè§†é¢‘MD5æŒ‡çº¹è‡ªåŠ¨åŒ¹é…å¼¹å¹•ï¼Œæ— éœ€æ‰‹åŠ¨æœç´¢ |
| **ğŸ’¬ å¤šæºå¼¹å¹•æ”¯æŒ** | å…¼å®¹ Bç«™ã€Aç«™ã€Dç«™ç­‰å¤šä¸ªå¼¹å¹•æºï¼Œæ”¯æŒXMLå¼¹å¹•å¯¼å…¥ |
| **ğŸ¨ ç°ä»£åŒ–UIè®¾è®¡** | æ¸å˜èƒŒæ™¯ã€æ¯›ç»ç’ƒæ•ˆæœã€å“åº”å¼å¸ƒå±€ã€æ·±è‰²æ¨¡å¼æ”¯æŒ |
| **âš™ï¸ ä¸°å¯Œè®¾ç½®é€‰é¡¹** | æ’­æ”¾å™¨å†…æ ¸åˆ‡æ¢ã€å¼¹å¹•æ ·å¼è‡ªå®šä¹‰ã€ç½‘ç»œä»£ç†é…ç½® |
| **ğŸ’¾ è®¾ç½®äº‘åŒæ­¥** | æ”¯æŒè®¾ç½®å¯¼å…¥å¯¼å‡ºï¼Œä¾¿äºå¤‡ä»½å’Œè¿ç§» |

### ğŸš€ è¿›é˜¶ç‰¹æ€§

- **WebSocket å®æ—¶é€šä¿¡** - çŠ¶æ€å®æ—¶åŒæ­¥ï¼Œå¤šç«¯åä½œ
- **å¼¹å¹•æ ¼å¼è½¬æ¢** - æ”¯æŒ XML/ASS/JSON ç­‰æ ¼å¼äº’è½¬
- **æ™ºèƒ½ç¼“å­˜æœºåˆ¶** - åŒ¹é…ç»“æœç¼“å­˜ï¼Œå‡å°‘APIè°ƒç”¨
- **å¤šæ’­æ”¾å™¨å†…æ ¸** - NPlayerã€ArtPlayerã€DPlayer å¯é€‰
- **ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ** - GPUè§£ç åŠ é€Ÿï¼Œé™ä½CPUå ç”¨
- **æ‰¹é‡å¤„ç†èƒ½åŠ›** - æ”¯æŒæ’­æ”¾åˆ—è¡¨ã€è¿ç»­æ’­æ”¾

---

## ğŸ”§ æŠ€æœ¯æ ˆ

<table>
<tr>
<td width="50%">

### ğŸ”™ åç«¯

- **FastAPI** - é«˜æ€§èƒ½å¼‚æ­¥Webæ¡†æ¶
- **Python 3.11+** - æœ€æ–°Pythonç‰¹æ€§
- **asyncio** - å¼‚æ­¥I/Oæ”¯æŒ
- **httpx** - ç°ä»£HTTPå®¢æˆ·ç«¯
- **Pydantic** - æ•°æ®éªŒè¯
- **websockets** - å®æ—¶é€šä¿¡
- **aiofiles** - å¼‚æ­¥æ–‡ä»¶å¤„ç†

</td>
<td width="50%">

### ğŸŒ å‰ç«¯

- **HTML5** - è¯­ä¹‰åŒ–æ ‡ç­¾
- **CSS3** - ç°ä»£å¸ƒå±€ä¸åŠ¨ç”»
- **JavaScript ES6+** - åŸç”Ÿå¼€å‘
- **NPlayer** - ä¸»æ’­æ”¾å™¨å†…æ ¸
- **WebSocket** - å®æ—¶é€šä¿¡
- **LocalStorage** - æœ¬åœ°å­˜å‚¨
- **Service Worker** - ç¦»çº¿æ”¯æŒ

</td>
</tr>
</table>

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ’» æœ¬åœ°å¼€å‘

#### 1ï¸âƒ£ ç¯å¢ƒè¦æ±‚

- Python 3.11+
- Git
- ç°ä»£æµè§ˆå™¨
- å¯é€‰: ffmpeg (è§†é¢‘å¤„ç†)

#### 2ï¸âƒ£ å®‰è£…æ­¥éª¤

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/danplay.git
cd danplay

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ(Windows)
python -m venv venv
venv\Scripts\activate

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ (Linux/Mac)
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¤åˆ¶é…ç½®æ–‡ä»¶
cp .env.example .env

# å¯åŠ¨æœåŠ¡
python -m uvicorn app.main:app --reload --host 127.0.0.1 --port 8000
```

#### 3ï¸âƒ£ è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®: **http://localhost:8000**

---

## ğŸ³ Dockeréƒ¨ç½²

### ğŸ¯ ä¸€é”®éƒ¨ç½²

#### Windows PowerShell
```powershell
# å¯åŠ¨åŸºç¡€æœåŠ¡
.\deploy.ps1 start

# å¯åŠ¨å®Œæ•´æœåŠ¡ï¼ˆåŒ…å«Nginxå’ŒRedisï¼‰
.\deploy.ps1 start -WithAll
```

#### Linux/Mac
```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x deploy.sh

# å¯åŠ¨åŸºç¡€æœåŠ¡
./deploy.sh start

# å¯åŠ¨å®Œæ•´æœåŠ¡
./deploy.sh start --with-all
```

### ğŸ“¦ Docker Compose

```bash
# åŸºç¡€éƒ¨ç½²
docker-compose up -d

# åŒ…å«Nginx
docker-compose --profile with-nginx up -d

# åŒ…å«Redis
docker-compose --profile with-redis up -d

# å®Œæ•´éƒ¨ç½²
docker-compose --profile with-nginx --profile with-redis up -d
```

### ğŸ”§ é…ç½®è¯´æ˜

```env
# .env æ–‡ä»¶é…ç½®
SECRET_KEY=your-secret-key  # å¿…é¡»ä¿®æ”¹
DEBUG=false
EXTERNAL_PORT=8000
MAX_UPLOAD_SIZE=5368709120  # 5GB
DANDAN_API_BASE_URL=https://api.dandanplay.net/api/v2
```

æŸ¥çœ‹è¯¦ç»†éƒ¨ç½²æ–‡æ¡£: [ğŸ“šDOCKER_DEPLOY.md](DOCKER_DEPLOY.md)

---

## ğŸ“¡ APIæ–‡æ¡£

### ğŸ“– äº¤äº’å¼æ–‡æ¡£

å¯åŠ¨åº”ç”¨åè®¿é—®ï¼š

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### ğŸ“¦ ä¸»è¦API

<details>
<summary>ç‚¹å‡»å±•å¼€APIåˆ—è¡¨</summary>

#### è§†é¢‘ç®¡ç†
```
POST   /api/video/upload          # ä¸Šä¼ è§†é¢‘
GET    /api/video/stream/{id}     # æµå¼æ’­æ”¾
GET    /api/video/md5/{id}        # è·å–MD5
DELETE /api/video/{id}            # åˆ é™¤è§†é¢‘
```

#### å¼¹å¹•åŒ¹é…
```
POST   /api/match/                # MD5åŒ¹é…
GET    /api/match/search          # æœç´¢ä½œå“
GET    /api/match/anime/{id}      # ä½œå“è¯¦æƒ…
```

#### å¼¹å¹•å¤„ç†
```
GET    /api/danmaku/{id}          # è·å–å¼¹å¹•
POST   /api/danmaku/external      # ç¬¬ä¸‰æ–¹å¼¹å¹•
POST   /api/danmaku/parse/xml     # è§£æXML
POST   /api/danmaku/convert       # æ ¼å¼è½¬æ¢
```

#### è®¾ç½®ç®¡ç†
```
GET    /api/settings              # è·å–è®¾ç½®
POST   /api/settings              # ä¿å­˜è®¾ç½®
DELETE /api/settings              # é‡ç½®è®¾ç½®
```

#### WebSocket
```
WS     /ws/{client_id}            # å®æ—¶é€šä¿¡
```

</details>

---

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
danplay/
â”œâ”€â”€ app/                    # ğŸ“¦ åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ api/               # ğŸŒ APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ video.py      # è§†é¢‘ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ danmaku.py    # å¼¹å¹•å¤„ç†
â”‚   â”‚   â”œâ”€â”€ match.py      # å¼¹å¹•åŒ¹é…
â”‚   â”‚   â”œâ”€â”€ websocket.py  # å®æ—¶é€šä¿¡
â”‚   â”‚   â””â”€â”€ settings.py   # è®¾ç½®ç®¡ç†
â”‚   â”œâ”€â”€ core/              # ğŸ”§ æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ services/          # ğŸ’¼ ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ schemas/           # ğŸ“ æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ main.py           # ğŸš€ åº”ç”¨å…¥å£
â”œâ”€â”€ static/                # ğŸ¨ é™æ€èµ„æº
â”‚   â”œâ”€â”€ css/              # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ js/               # è„šæœ¬æ–‡ä»¶
â”œâ”€â”€ templates/             # ğŸ“„ HTMLæ¨¡æ¿
â”œâ”€â”€ nginx/                 # ğŸŒ Nginxé…ç½®
â”œâ”€â”€ docker/                # ğŸ³ Dockeré…ç½®
â”œâ”€â”€ docs/                  # ğŸ“– é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ tests/                 # ğŸ§ª æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ .env.example           # ğŸ”’ é…ç½®ç¤ºä¾‹
â”œâ”€â”€ docker-compose.yml     # ğŸ“¦ å®¹å™¨ç¼–æ’
â”œâ”€â”€ Dockerfile             # ğŸ“¦ é•œåƒæ„å»º
â””â”€â”€ requirements.txt       # ğŸ“š ä¾èµ–åˆ—è¡¨
```

## ğŸ³ Dockeréƒ¨ç½²

### ä½¿ç”¨é¢„æ„å»ºé•œåƒ
```bash
docker run -d \
  --name danplay \
  -p 8000:8000 \
  -v ./uploads:/app/uploads \
  -v ./user_settings.json:/app/user_settings.json \
  danplay:latest
```

### è‡ªè¡Œæ„å»ºé•œåƒ
```bash
# æ„å»ºé•œåƒ
docker build -t danplay .

# ä½¿ç”¨docker-compose
docker-compose up -d
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
| å˜é‡å | é»˜è®¤å€¼ | æè¿° |
|--------|--------|------|
| `SECRET_KEY` | - | åº”ç”¨å¯†é’¥ï¼ˆå¿…å¡«ï¼‰ |
| `DEBUG` | `false` | è°ƒè¯•æ¨¡å¼ |
| `HOST` | `0.0.0.0` | ç›‘å¬åœ°å€ |
| `PORT` | `8000` | ç›‘å¬ç«¯å£ |
| `MAX_UPLOAD_SIZE` | `5368709120` | æœ€å¤§ä¸Šä¼ å¤§å°(å­—èŠ‚) |
| `DANDAN_API_BASE_URL` | `https://api.dandanplay.net/api/v2` | APIåœ°å€ |

### ç”¨æˆ·è®¾ç½®
ç”¨æˆ·è®¾ç½®ä¿å­˜åœ¨ `user_settings.json` æ–‡ä»¶ä¸­ï¼ŒåŒ…å«ï¼š
- ç•Œé¢ä¸»é¢˜å’Œè¯­è¨€
- æ’­æ”¾å™¨é…ç½®
- å¼¹å¹•æ ·å¼è®¾ç½®
- ç½‘ç»œä»£ç†é…ç½®
- é«˜çº§é€‰é¡¹

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼æ— è®ºæ˜¯æ–°åŠŸèƒ½ã€bugä¿®å¤è¿˜æ˜¯æ–‡æ¡£æ”¹è¿›ã€‚

### å¦‚ä½•è´¡çŒ®

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### å¼€å‘è§„èŒƒ
- éµå¾ª PEP 8 Pythonä»£ç è§„èŒƒ
- æ·»åŠ é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ›´æ–° README æ–‡æ¡£

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01)
- ğŸ‰ é¦–æ¬¡å‘å¸ƒ
- âœ¨ ç°ä»£åŒ–UIé‡æ„
- ğŸš€ æ€§èƒ½ä¼˜åŒ–
- ğŸ”§ å®Œå–„è®¾ç½®åŠŸèƒ½
- ğŸ› ä¿®å¤å·²çŸ¥é—®é¢˜

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ™ è‡´è°¢

- [å¼¹å¼¹play](https://www.dandanplay.com/) - ä¼˜ç§€çš„å¼¹å¹•æ’­æ”¾å™¨
- [FastAPI](https://fastapi.tiangolo.com) - ç°ä»£Webæ¡†æ¶
- æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·çš„æ”¯æŒ
---

<div align="center">
  <sub>ç”¨ â¤ï¸ æ‰“é€ ï¼Œè®©æœ¬åœ°è§†é¢‘è§‚çœ‹æ›´æœ‰è¶£</sub>
</div>
